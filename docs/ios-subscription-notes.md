# iOSのみ・App Storeサブスクでやる場合

会員制サブスクなら**会員（認証）は必須**。プラットフォームを **iOSのみ** にして、**App Storeの課金（In-App Purchase / サブスクリプション）** を使う場合の整理。

---

## 1. わりかし楽に実装できるか？

**はい。Web＋Stripeより「やること」は少なくしぼれる。**

| 項目 | Web + Stripe | iOSのみ + App Storeサブスク |
|------|----------------|-----------------------------|
| 決済UI・カード入力 | 自分で用意 or Stripe Elements | 不要（Appleが提供） |
| 請求・継続課金 | 自分で実装 | Appleが自動でやってくれる |
| 解約・返金 | ポリシーを自分で | App Storeの仕組みに乗れる |
| 実装 | Stripe連携・Webhook・顧客管理 | StoreKit 2 で購入・復元・状態確認 |

- **StoreKit 2**（iOS 15〜）で、購入・復元・「今サブスク有効か」の判定がAPIで揃っている。レシート検証もクライアント側である程度できる。
- App Store Connect で「サブスク商品」を登録し、アプリ側でその商品を購入・復元する流れに乗ればよい。

**注意点**
- **バックエンド（チャット・AIを提供するサーバー）** が「このユーザーは課金済みか」を知る必要がある。
  - **案A**: Apple の **App Store Server Notifications** をサーバーで受け、サブスク状態の変化（新規・更新・解約）を保存する。
  - **案B**: アプリから「購入済み」の情報（トランザクションID等）をサーバーに送り、サーバーで Apple に問い合わせて検証する。
- どちらにしても「会員」と「サブスク状態」をサーバー側で持つ必要はあるが、**決済そのものはApple任せ**なので、Stripeより実装はシンプルになりやすい。

---

## 2. Appleの手数料

- **通常**: 売上の約 **30%** が Apple に（開発者取り分 70%）。
- **サブスク 2年目以降**: 同一サブスクが1年以上続くと 約 **15%**（開発者取り分 85%）。
- **Small Business Program**（年間収益 100万ドル以下）: **15%**。取り分 85%。

**前提**: 本サービスでは **Small Business Program への参加を必須** とする。収益が 100万ドル/年以下であれば対象となり、手数料を 15% に抑えられる。

例：月額 2,500円 のとき（Small Business Program 適用・15%）  
- 15%（Small Business Program）→ あなたの取り分 約 2,125円  

APIコスト等を差し引いても、前回の試算程度なら十分マージンは残る。

---

## 3. 実装の流れ（最小）

1. **App Store Connect**  
   サブスクリプション商品（例：月額 1,980円 / 2,980円）を登録。
2. **アプリ（Swift / SwiftUI など）**  
   StoreKit 2 で「商品一覧取得 → 購入 → 復元 → 現在の権利状態」を実装。
3. **会員（認証）**  
   Apple Sign In やメールなどで「誰か」を識別。サブスク状態は Apple が管理。
4. **バックエンド**  
   - オプション: **App Store Server Notifications** で「課金開始・更新・解約」を受け取り、DBの「会員のサブスク状態」を更新。  
   - または: アプリから「有効なサブスクあり」とトランザクション情報を送り、サーバーが Apple API で検証。
5. **チャット・AI**  
   リクエスト時に「この会員は有料プランか」を見て、利用制限をかける。

デザインを凝らさない前提なら、**iOSのみ＋App Storeサブスク** にすると、決済まわりは「わりかし楽」に実装できる。

---

## 4. まとめ

- **会員は必須**（サブスクなら当然）。
- **iOSのみで App Store サブスク** にすれば、決済は Apple 任せにでき、**わりかし楽に実装できる**。
- 手数料は 30%（2年目以降 or 小規模なら 15%）を考慮する必要があるが、想定単価なら採算は可能。
- バックエンドでは「誰が有料会員か」を Apple の通知 or レシート検証で把握する部分だけ用意する。
